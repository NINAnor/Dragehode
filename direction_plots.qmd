---
title: "Figurer som viser retning i endring"
editor: visual
---





```{r}
#| echo: false
#| message: false
#| warning: false
library(tidyverse)
library(bayestestR)
library(see)
library(rstanarm)

lokalitetsestimater <- readRDS("C:/Users/matthew.grainger/Documents/Projects_in_development/Dragehode2023/data/derived_data/lokalitetsestimater.RDS")
lokalitetsdata <- readRDS("C:/Users/matthew.grainger/Documents/Projects_in_development/Dragehode2023/data/lokalitetsdata.RDS")
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| eval: false
#length(lokalitetsestimater)
#seq_along(lokalitetsestimater)

for (i in seq_along(lokalitetsestimater)){
  dlist=pluck(lokalitetsestimater,i)
  df=data.frame(year=dlist$year, nTot=dlist$nTot, nTotUpp=dlist$Tot.CI[,2],
                nTotLow=dlist$Tot.CI[,1], nFert=dlist$nFert,
                nFertUpp=dlist$Fert.CI[,2],
                nFertLow=dlist$Fert.CI[,1], 
                nVeg=dlist$nVeg,
                nVegUpp=dlist$Veg.CI[,2],
                nVegLow=dlist$Veg.CI[,1],
                nSma=dlist$nSma,
                nSmaUpp=dlist$Sma.CI[,2],
                nSmaLow=dlist$Sma.CI[,1],
                lokalitet=dlist$lokalitet)
  saveRDS(df, 
          paste0("data/derived_data/direction_plots/",dlist$lokalitet, "_data.RDS"))
  
}
rds_combo <- list.files(path ="data/derived_data/direction_plots" , pattern = "*.RDS", full.names = TRUE ) %>%
  map_dfr(readRDS)

#names(rds_combo)

#rds_combo

local=lokalitetsdata %>% 
  select(Region, Kommune, Lokalitet) %>% 
  rename(lokalitet=Lokalitet)
rds_combo=rds_combo %>% 
  left_join(
    .,local
  )

for (i in seq_along(lokalitetsestimater)){
  tryCatch(
    {
      lokalitetsnavn=unique(rds_combo$lokalitet)
      lokalitetsnavn_=lokalitetsnavn[i]
      modeldata=rds_combo %>% filter(lokalitet==lokalitetsnavn_) |> distinct()
      model1<-stan_glm(nTot~year, data=modeldata)
      saveRDS(model1, file=paste0("data/derived_data/direction_plots/models/",lokalitetsnavn_, ".RDS"))
      pd=bayestestR::p_direction(model1)
      p=plot(pd)+ggtitle(paste0(lokalitetsnavn_))
      ggsave(filename=paste0("data/derived_data/direction_plots/plots/", lokalitetsnavn_,".png"),plot = last_plot())
    },
    error=function(cond) {
      message("Here's the original error message:")
      message(cond)
      # Choose a return value in case of error
      return(NA)
    },
    warning=function(cond) {
      message("Here's the original warning message:")
      message(cond)
      # Choose a return value in case of warning
      return(NULL)
    }
  )}


```


```{r}
#| echo: false
#| message: false
#| warning: false
#| eval: false
rds_combo <- list.files(path ="data/derived_data/direction_plots" , pattern = "*.RDS", full.names = TRUE ) %>%
  map_dfr(readRDS)


local=lokalitetsdata %>% 
  select(Region, Kommune, Lokalitet) %>% 
  rename(lokalitet=Lokalitet)
rds_combo=rds_combo %>% 
  left_join(
    .,local
  )



for (i in seq_along(unique(rds_combo$Region))){
  tryCatch(
    {
      Regionsnavn=unique(rds_combo$Region)
      Regionsnavn_=Regionsnavn[i]
      modeldata=
        rds_combo %>% filter(Region==Regionsnavn_) |> distinct()
      model1<-stan_glm(nTot~year, data=modeldata)
      saveRDS(model1, file=paste0("data/derived_data/direction_plots/models/",Regionsnavn_, ".RDS"))
      pd=bayestestR::p_direction(model1)
      p=plot(pd)+ggtitle(paste0(Regionsnavn_))
      ggsave(filename=paste0("data/derived_data/direction_plots/plots/", Regionsnavn_,".png"),plot = last_plot())
    },
    error=function(cond) {
      message("Here's the original error message:")
      message(cond)
      # Choose a return value in case of error
      return(NA)
    },
    warning=function(cond) {
      message("Here's the original warning message:")
      message(cond)
      # Choose a return value in case of warning
      return(NULL)
    }
  )}

```

## Hadeland

![](data/derived_data/direction_plots/plots/Hadeland.png)

### Sites

![](data/derived_data/direction_plots/plots/Aslaksrud.png)

![](data/derived_data/direction_plots/plots/Falang.png)

![](data/derived_data/direction_plots/plots/Gjefsen.png)

![](data/derived_data/direction_plots/plots/Gran sykehjem.png) 

![](data/derived_data/direction_plots/plots/Grindaker.png)

![](data/derived_data/direction_plots/plots/Lyngstad Vestre.png)

## Oslo

![](data/derived_data/direction_plots/plots/Oslo.png)

### Sites

![](data/derived_data/direction_plots/plots/Ekebergskråningen.png) 

![](data/derived_data/direction_plots/plots/Heggholmen.png)

![](data/derived_data/direction_plots/plots/Horgen.png) 

![](data/derived_data/direction_plots/plots/Hovedøya V.png) 

![](data/derived_data/direction_plots/plots/Hovedøya.png)

![](data/derived_data/direction_plots/plots/Kalvøya.png) 

![](data/derived_data/direction_plots/plots/Møllerenga.png)

![](data/derived_data/direction_plots/plots/Spireodden.png)

![](data/derived_data/direction_plots/plots/Storøykilen.png) 

![](data/derived_data/direction_plots/plots/Svartorseter.png)

![](data/derived_data/direction_plots/plots/Telenor.png)

![](data/derived_data/direction_plots/plots/Vendelenga.png)

## Ringerike

![](data/derived_data/direction_plots/plots/Ringerike.png)

## Sites
![](data/derived_data/direction_plots/plots/Auren.png) 

![](data/derived_data/direction_plots/plots/Buss-stopp.png)   

![](data/derived_data/direction_plots/plots/Haugsbygd, vestvendt vegskråning.png)  

![](data/derived_data/direction_plots/plots/Hurumåsen.png) 

![](data/derived_data/direction_plots/plots/Nordre Ultvet.png)   

![](data/derived_data/direction_plots/plots/Ultvet SØ.png)  

![](data/derived_data/direction_plots/plots/Åsaporten NØ.png)



